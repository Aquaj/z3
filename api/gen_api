#!/usr/bin/env ruby

require "pathname"
require_relative "definition"


class GenerateAPI
  def initialize(*paths)
    paths.each do |path|
      add_file! Pathname(path)
    end
    @definitions = []
  end

  def run!
    # ...
  end

  private

  def add_definition!(definition)
    @definitions << Definition.new(definition)
  end

  def add_file!(path)
    path.readlines.grep(/def_API/).map(&:strip).each do |definition|
      puts definition
      add_definition! definition
    end
  end
end

if ARGV.empty?
  STDERR.puts "Usage: #{$0} path1.h path2.h [...]"
  exit 1
end

GenerateAPI.new(*ARGV).run!
